В питончике (ну и в целом) веб-сокеты работают так (на примере websocket_endpoint)
 - автоматом делается рукопожатие через HTTP (до await websocket.accept())
 - затем выполняется тело функции, все данные передаются уже через WebSocket-протокол
 - при выходе из функции, соединение обрывается
